---
layout: post
title: Como exportar usuários do Azure AD para console OCI e Oracle IDCS
subtitle: Configure a sincronização dos usuários do Azure AD para Oracle Cloud Infrastructure e Oracle IDCS 
tags: [Cloud, Oracle, Azure, Azure AD, User, Group, Sync]
comments: true
---


## Configure o Oracle Cloud Infrastructure Console e IDCS para aceitar sincronização dos usuário via Azure AD

Navegue até **Identity > Federation > Identity Provider Details** para acessar a console do IDCS. 

![oci-01](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

![oci-02](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

![oci-03](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

Já na console do IDCS clique em **Applications and Services,** em **Add**  e selecione **Confidential Application.**

![oci-04](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

![oci-05](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

Dê um nome para o aplicativo e clique em **Next** em todas as próximas etapas e então clique e, **Finish.**

![oci-06](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

Em seguida ative o aplicativo. 

![oci-07](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

Abra o aplicativo e vá até **Configuration > Client Configuration** e preencha os campos exatamente como nas imagens mostradas abaixo e salve a configuração clicando em **Save.**

**Allowed Grand Types**
-Client Credentials
-JWT Assention
-Refresh Token
-Authotization

**Redirect URL:** https://localhost/callback

**Client Type:** Confidential

**Grant the client access to Identity Cloud Service Admin APIs**
-Identity Domain Administrator

![oci-08](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

![oci-09](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

Um novo campo chamado **General Information** deve ser apresentado, salve o valor do **Client ID e Client Secret,** serão utilizados para configurar do lado da Azure.

![oci-10](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

## Crie e configure um Enterprise Application no Azure AD

Navegue até **Azure AD > Enterprise applications > All Applications,** clique em  **New Application** e em seguida em **Create your own application,** dê um nome e escolha a opção **Integrate any other application you don't find in the gallery** e clique em **Create.**

![oci-11](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

![oci-12](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

![oci-13](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

Navegue até **Provisioning,** clique em **Get Start.**

![oci-14](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

Em seguida selecione o **Provisioning Mode** para **Automatic.**

![oci-15](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

**Admin Credentials:** 

**Tenant URL:** Insira a URL IDCS da sua conta OCI. Por exemplo https://idcs-xxxxxxxxxxxxxxxxxxx.identity.oraclecloud.com/admin/v1

**Secret Token:** O Secret Token precisa ser convertido para Base64 e para isso será necessário o Client ID e Client Secret que foi salvo anteriomente.

-**Para Macbook:** Execute o seguinte comando no terminal:

```javascript
echo -n "f6251e54daaa4a67a7f26614b883aeb1:18fa5872-88c5-4879-b327-32eebe9712bc" | base64
```

-**Para Linux:** Execute o seguinte comando no terminal:

```javascript
echo -n "f6251e54daaa4a67a7f26614b883aeb1:18fa5872-88c5-4879-b327-32eebe9712bc" | base64 -w 0
```

-**Para Windows:** Crie um arquivo .txt na pasta C:\temp com o nome appCreds.txt, abra o CMD como administrador e execute o seguinte comando:

```javascript
certutil -encode C:\temp\appCreds.txt C:\temp\appbase64Creds.txt
```
Abra o arquivo C:\temp\appbase64Creds.txt, copie o conteúdo e feche o arquivo.

![oci-16](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

Adicione os valores e clique em **Test Connection.** Caso a conexão seja feita com sucesso clique em **Save.**

![oci-17](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

**Mappings:** Mantenha a configuracão padrão ou personalize como desejar.

![oci-18](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

**Settings:** Adicione um e-mail e marque a opção **Send an email notification when a failure occurs**, em **Scope** escolha a opção **Sync only assigned users and groups** isso significa que apenas os usuário e grupos associados serão sincronizados, por fim clique em **Save.**

![oci-19](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

## Usuários e Grupos que serão sincronizados

No Azure AD crie um grupo de segurança e adicione os usuários que devem ser sincronizados, caso precise de ajuda com essa task acesse este [tutorial.](https://docs.microsoft.com/pt-br/azure/active-directory/fundamentals/active-directory-groups-create-azure-portal)

Navegue até **Azure AD > Enterprise applications > Seu Aplicativo > Users and groups** clique em **Add User/Group** para associar o grupo recém criado. **Obs:** Um requisito para adicionar um grupo é ter Azure AD Premium P2 habilitada, adicione a licença Premium P2 em 5 passos com este [tutorial.](https://azure.microsoft.com/pt-br/trial/get-started-active-directory/)

![oci-20](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

![oci-21](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

Volte para **Provisioning** em  **Azure AD > Enterprise applications > Seu Aplicativo > Provisioning** e clique em **Edit Provisioning** e marque **Provisioning Status** para ON e clique em **Save.**

![oci-22](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)

Agora com tudo configurado volte para **Provisioning** em  **Azure AD > Enterprise applications > Seu Aplicativo > Provisioning** e verifique a que o provisionamento foi iniciado. A primeira sincronização pode levar até 40 minutos, mas isso depende da quantidade de usuários que serão adicionados para a console Oracle Cloud e IDCS.

![oci-23](https://objectstorage.sa-saopaulo-1.oraclecloud.com/p/bSHXe1-VoKSEdEe4Pgj2QIWInsAG0UnlXNGLJ9zrLAWmSlREAJNXi3kYwkuPchs3/n/gr8gkzaf8nit/b/bucket-euoraf4-site/o/POST-SCRIPTS/ss-01.png)








